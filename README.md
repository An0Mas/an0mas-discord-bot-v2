# an0mas-discord-bot-v2 (v1.2.1)

å€‹äººç”¨ Discord Botï¼ˆTypeScript + Sapphire Framework / discord.js v14ï¼‰

## æ©Ÿèƒ½

### /help

ã‚³ãƒãƒ³ãƒ‰ã®ä½¿ã„æ–¹ã‚’ä¸€è¦§ãƒ»è©³ç´°ã§ç¢ºèªã§ãã¾ã™ï¼ˆæœ¬äººã®ã¿è¡¨ç¤ºï¼‰ã€‚

### /bosyu

å‚åŠ è€…å‹Ÿé›†ã‚’ä½œæˆã—ã¾ã™ã€‚ãƒœã‚¿ãƒ³ã§å‚åŠ /å–æ¶ˆ/ç· åˆ‡ã€æ®‹ã‚Šäººæ•°ã®èª¿æ•´ãŒã§ãã¾ã™ã€‚

- å¼•æ•°ãªã—ï¼šãƒ¢ãƒ¼ãƒ€ãƒ«ã§å…¥åŠ›
- å¼•æ•°ã‚ã‚Šï¼šå³æ™‚ä½œæˆ

### /bosyu-bpsr

BPSRï¼ˆã‚²ãƒ¼ãƒ ï¼‰ç‰¹åŒ–ã®ãƒ­ãƒ¼ãƒ«åˆ¥å‹Ÿé›†ã‚’ä½œæˆã—ã¾ã™ã€‚

- ğŸ›¡ï¸ ã‚¿ãƒ³ã‚¯ / âš”ï¸ ã‚¢ã‚¿ãƒƒã‚«ãƒ¼ / ğŸ’š ãƒ’ãƒ¼ãƒ©ãƒ¼ ã§ãƒ­ãƒ¼ãƒ«é¸æŠ
- ãƒ­ãƒ¼ãƒ«å¤‰æ›´ã¯ãƒœã‚¿ãƒ³æŠ¼ã—ç›´ã—ã§è‡ªå‹•åˆ‡æ›¿
- æŠ•ç¨¿è€…ã¯è‡ªå‹•å‚åŠ ã›ãšã€ãƒœã‚¿ãƒ³ã§å‚åŠ 

### /bpsr-role

ãƒ­ãƒ¼ãƒ«ä»˜ä¸ãƒœã‚¿ãƒ³ã‚’è¨­ç½®ã—ã¾ã™ã€‚ã‚¿ãƒ³ã‚¯/ã‚¢ã‚¿ãƒƒã‚«ãƒ¼/ãƒ’ãƒ¼ãƒ©ãƒ¼ã‹ã‚‰é¸æŠã—ã€æ’ä»–çš„ã«ãƒ­ãƒ¼ãƒ«ã‚’ä»˜ä¸ã—ã¾ã™ã€‚

### /remind

æŒ‡å®šæ™‚åˆ»ã«DMã§ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼é€šçŸ¥ã‚’å—ã‘å–ã‚Œã¾ã™ã€‚

### /remind-list

ç™»éŒ²æ¸ˆã¿ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã®ä¸€è¦§è¡¨ç¤ºãƒ»å‰Šé™¤ãŒã§ãã¾ã™ã€‚

### /dice

ãƒ€ã‚¤ã‚¹ãƒ­ãƒ¼ãƒ«ã€‚NdMå½¢å¼ã§æŒ‡å®šã§ãã¾ã™ï¼ˆä¾‹: 2d6, 1d100ï¼‰ã€‚

### /verify

åˆè¨€è‘‰èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã€‚æŒ‡å®šã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒ­ãƒ¼ãƒ«ã‚’ä»˜ä¸ã—ã¾ã™ã€‚

### /allow (ã‚ªãƒ¼ãƒŠãƒ¼å°‚ç”¨)

ã‚µãƒ¼ãƒãƒ¼è¨±å¯ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼/ãƒ­ãƒ¼ãƒ«æ¨©é™ã‚’ç®¡ç†ã—ã¾ã™ã€‚

### /config (ã‚ªãƒ¼ãƒŠãƒ¼å°‚ç”¨)

Botè¨­å®šãƒ»æ¨©é™è¨­å®šã‚’ç¢ºèªã—ã¾ã™ã€‚

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1. ä¾å­˜ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
pnpm install
```

### 2. ç’°å¢ƒå¤‰æ•°

`.env.example` ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ `.env` ã‚’ä½œæˆã—ã€ä»¥ä¸‹ã‚’è¨­å®šï¼š

- `DISCORD_TOKEN` - Botãƒˆãƒ¼ã‚¯ãƒ³
- `CLIENT_ID` - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ID
- `OWNER_ID` - Botã‚ªãƒ¼ãƒŠãƒ¼ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID

### 3. èµ·å‹•

```bash
pnpm dev
```

> **Note**: SapphireãŒã‚³ãƒãƒ³ãƒ‰ã‚’è‡ªå‹•ç™»éŒ²ã™ã‚‹ãŸã‚ã€`pnpm deploy` ã¯ä¸è¦ã§ã™ã€‚

## Botæ¨©é™è¨­å®šï¼ˆOAuth2 URL Generatorï¼‰

Discord Developer Portal ã§Botæ‹›å¾…URLã‚’ç”Ÿæˆã™ã‚‹éš›ã«å¿…è¦ãªè¨­å®šã§ã™ã€‚

### å¿…è¦ãªScopes

- `bot`
- `applications.commands`

### å¿…è¦ãªBot Permissions

| ã‚«ãƒ†ã‚´ãƒª | æ¨©é™                 | å¿…é ˆ |
| -------- | -------------------- | :--: |
| General  | View Channels        |  âœ…  |
| General  | Manage Roles         |  âœ…  |
| Text     | Send Messages        |  âœ…  |
| Text     | Embed Links          |  âœ…  |
| Text     | Read Message History |  âœ…  |
| Text     | Use Slash Commands   |  âœ…  |
| Text     | Add Reactions        |  -   |

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
src/
â”œâ”€â”€ index.ts                 # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆï¼ˆSapphireClientåˆæœŸåŒ–ï¼‰
â”œâ”€â”€ db.ts                    # SQLiteæ“ä½œ
â”œâ”€â”€ config.ts                # ç’°å¢ƒå¤‰æ•°è¨­å®š
â”œâ”€â”€ command-config.ts        # ã‚³ãƒãƒ³ãƒ‰ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ»æ¨©é™ã‚¿ã‚¤ãƒ—
â”œâ”€â”€ scheduler.ts             # ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©
â”œâ”€â”€ commands/                # Sapphire Commandã‚¯ãƒ©ã‚¹ï¼ˆè‡ªå‹•ç™»éŒ²ï¼‰
â”‚   â”œâ”€â”€ HelpCommand.ts
â”‚   â”œâ”€â”€ BosyuCommand.ts
â”‚   â”œâ”€â”€ BosyuBpsrCommand.ts
â”‚   â”œâ”€â”€ BpsrRoleCommand.ts
â”‚   â”œâ”€â”€ RemindCommand.ts
â”‚   â”œâ”€â”€ RemindListCommand.ts
â”‚   â”œâ”€â”€ DiceCommand.ts
â”‚   â”œâ”€â”€ VerifyCommand.ts
â”‚   â”œâ”€â”€ AllowCommand.ts
â”‚   â””â”€â”€ ConfigCommand.ts
â”œâ”€â”€ interaction-handlers/    # Sapphire InteractionHandlerï¼ˆãƒœã‚¿ãƒ³ãƒ»ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼‰
â”‚   â””â”€â”€ ...
â”œâ”€â”€ listeners/               # Sapphireã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ï¼ˆã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼‰
â”‚   â””â”€â”€ ...
â”œâ”€â”€ preconditions/           # Sapphire Preconditionï¼ˆæ¨©é™ãƒã‚§ãƒƒã‚¯ï¼‰
â”‚   â””â”€â”€ GuildAllowed.ts
â””â”€â”€ lib/                     # å…±æœ‰ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
    â”œâ”€â”€ permission-utils.ts  # æ¨©é™ãƒã‚§ãƒƒã‚¯
    â”œâ”€â”€ error-notify.ts      # ã‚¨ãƒ©ãƒ¼DMé€šçŸ¥
    â”œâ”€â”€ help-utils.ts
    â”œâ”€â”€ bosyu-utils.ts
    â”œâ”€â”€ bosyu-bpsr-utils.ts
    â”œâ”€â”€ bpsr-role-utils.ts
    â”œâ”€â”€ remind-utils.ts
    â””â”€â”€ verify-utils.ts
```

## DB

- `./data/dev.sqlite3` ã‚’åˆ©ç”¨ï¼ˆèµ·å‹•æ™‚ã«è‡ªå‹•ç”Ÿæˆï¼‰
- WALãƒ¢ãƒ¼ãƒ‰ + busy_timeout=5000ms

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Sapphire Framework
- **Discord**: discord.js v14
- **è¨€èª**: TypeScript (strict mode)
- **DB**: SQLite (better-sqlite3)
