# 改善調査サマリ（2026-02-06）

## 現状サマリ（3-7行）
- コア機能は動作するが、募集系（`bosyu`/`bosyu-bpsr`）はメッセージ埋め込みを状態源にしており、同時クリック時の競合制御が未実装。
- メンション送信系（`mention-reactors`、募集メンション）は、429対策・送信キュー・分割送信の設計が不足し、高負荷時に失敗しやすい。
- DB層で `catch { return false; }` があり、重複以外の障害（ロック/破損）を誤判定する可能性がある。
- リマインダーは送信失敗時も削除されるため、一時障害で通知が消失する。
- DX面では `lint/test/build` が未整備、CI設定も未確認で、回帰検知の自動化が弱い。

## まず着手すべき5件（箇条書き）
- `db.ts` の重複挿入ハンドリングを例外分類化（重複のみ `false`、それ以外は throw）
- 募集メンション（`bosyu`/`bosyu-bpsr`）に分割送信と送信キューを追加
- `mention-reactors` の「100件上限」解消と 429 リトライ実装
- 募集ボタン更新に競合対策（楽観ロック/再取得再計算）を導入
- リマインダー送信失敗時の削除方針を見直し（再試行可能化）

## 実行結果（実行できたものだけ）
- lint: 未確認（`package.json` にスクリプト未定義）
- typecheck: 実行済み（`pnpm typecheck` / 終了コード 0）
- test: 未確認（`package.json` にスクリプト未定義）
- build: 未確認（`package.json` にスクリプト未定義）
- verify: 実行済み（`pnpm verify` / 終了コード 0、`typecheck` エイリアス）

## 未確認（未実行・判断不能）
- 実Discord環境での 429 発生時挙動（ローカル静的調査のみ）
- 並行クリック時の実測再現（手元で同時多発操作は未実施）
- CI上の品質ゲート（`.github/workflows` の定義ファイル未確認）
