# 改善調査サマリ（2026-02-14）

## 現状サマリ（3-7行）
- 2026-02-06 監査の主要リスクは多くが継続しており、特に募集メンションの文字数超過、同時操作競合、DB例外誤判定、リマインダー消失は未解消。
- 一方で旧監査項目の `ephemeral: true` は解消済み（`src` 全体で残存なし）。
- DXは改善が進み、`lint`/`format` 系スクリプトが追加済みだが、`format:check` は未整形ファイルが残って失敗。
- `mention-reactors` はメッセージ分割実装済みだが、リアクション取得が100件上限かつ429リトライ未実装で大規模運用リスクが残る。
- CIワークフロー未整備のため、品質ゲートはローカル実行依存のまま。

## まず着手すべき5件（箇条書き）
- `db.ts` の `addAllowedUser` / `addAllowedRole` で例外分類（重複のみ `false`、他は throw）を導入
- `bosyu` / `bosyu-bpsr` メンションの分割送信対応（2000文字制限回避）
- リマインダー失敗時に削除しない運用へ変更（再試行可能化）
- `mention-reactors` のリアクションユーザー全件取得（ページング）と429再試行を追加
- 募集ボタン更新に競合対策（最新再取得→再計算）を追加

## 実行結果（実行できたものだけ）
- lint: 成功（`pnpm verify` 内で `pnpm lint` 実行、終了コード 0）
- typecheck: 成功（`pnpm verify` 内で `pnpm typecheck` 実行、終了コード 0）
- test: 未確認（`package.json` に `test` スクリプト未定義）
- build: 未確認（`package.json` に `build` スクリプト未定義）
- format:check: 失敗（`pnpm format:check`、`docs/agent-notes/_TEMPLATE.md` / `src/lib/bosyu-bpsr-utils.ts` / `src/listeners/InteractionHandlerError.ts`）

## 未確認（未実行・判断不能）
- 実Discord環境での429発生時挙動（静的調査のみ）
- 同時クリック高負荷時の再現試験（2人以上の同時操作テスト未実施）
- CI導入後の運用結果（`.github/workflows` 自体が未整備）
