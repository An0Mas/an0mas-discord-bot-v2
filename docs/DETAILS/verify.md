# /verify 詳細仕様

> 合言葉認証システムの詳細仕様。

---

## 概要

お知らせチャンネル等に隠した合言葉を入力させることで、ロールを付与する認証システム。

---

## 機能フロー

1. 管理者が `/verify setup` で認証ボタンを設置
2. ユーザーがボタンをクリック
3. モーダルが表示され、合言葉を入力
4. 正解した場合、指定ロールが付与される

---

## コマンド

### /verify setup

認証ボタンを設置する。

| オプション  | 型     | 必須 | 説明                                 |
| ----------- | ------ | ---- | ------------------------------------ |
| keyword     | String | ✅   | 正解の合言葉                         |
| role        | Role   | ✅   | 付与するロール（選択式）             |
| title       | String | ❌   | 埋め込みタイトル（デフォルト: 認証） |
| description | String | ❌   | 埋め込み説明文                       |

### /verify edit

既存の認証設定を編集する。

| オプション  | 型     | 必須 | 説明             |
| ----------- | ------ | ---- | ---------------- |
| message_id  | String | ✅   | 認証メッセージID |
| keyword     | String | ❌   | 新しい合言葉     |
| role        | Role   | ❌   | 新しいロール     |
| title       | String | ❌   | 新しいタイトル   |
| description | String | ❌   | 新しい説明文     |

### /verify delete

認証ボタンを削除する。

| オプション | 型     | 必須 | 説明             |
| ---------- | ------ | ---- | ---------------- |
| message_id | String | ✅   | 認証メッセージID |

---

## 権限

- **Botオーナー**: 常に実行可能
- **許可ユーザー/ロール**: `/allow user|role add verify` で許可されたユーザー/ロール

---

## 照合ルール

- 大文字/小文字: **区別しない**
- 前後の空白: **自動除去**
- 再試行: **無制限**

---

## ボタン/モーダル ID形式

- ボタン: `verify-btn:{messageId}`
- モーダル: `verify-modal:{messageId}`

---

## 埋め込み仕様

### デフォルト

```
🔐 認証
下のボタンを押して合言葉を入力してください。
────
[✅ 認証する]
```

### カスタム（title/description指定時）

```
🔐 {title}
{description}
────
[✅ 認証する]
```

---

## エラーメッセージ

| 状況           | メッセージ                                                   |
| -------------- | ------------------------------------------------------------ |
| 合言葉不正解   | ❌ 合言葉が違います。もう一度お試しください。                |
| 認証済み       | ℹ️ 既に認証済みです。                                        |
| 設定無効       | ❌ この認証は無効になっています。                            |
| ロール付与失敗 | ❌ ロールの付与に失敗しました。BOTの権限を確認してください。 |
