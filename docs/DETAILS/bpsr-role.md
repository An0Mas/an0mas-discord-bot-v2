# /bpsr-role — ロール付与ボタン

## 概要

3つのボタン（タンク/アタッカー/ヒーラー）を持つパネルを設置し、ボタンを押すとDiscordロールが付与される機能。ロールは排他的（1つのみ保持可能）。

## 権限

- **コマンド実行**: `restricted`（Botオーナー または 許可されたユーザー/ロール）
- **ボタン操作**: 全員

## 使い方

### コマンド

```
/bpsr-role tank:@タンクロール attacker:@アタッカーロール healer:@ヒーラーロール [title:タイトル] [body:説明]
```

### 引数

| 引数     | 必須 | 説明                                                             |
| -------- | ---- | ---------------------------------------------------------------- |
| tank     | ✅   | タンクボタンで付与するロール                                     |
| attacker | ✅   | アタッカーボタンで付与するロール                                 |
| healer   | ✅   | ヒーラーボタンで付与するロール                                   |
| title    | ❌   | パネルのタイトル（デフォルト: ロール選択）                       |
| body     | ❌   | パネルの説明文（デフォルト: メインのジョブを選択してください。） |

## ボタン

| ボタン       | ラベル | 動作                        |
| ------------ | ------ | --------------------------- |
| 🛡️タンク     | 青     | タンクロールを付与/解除     |
| ⚔️アタッカー | 青     | アタッカーロールを付与/解除 |
| 💚ヒーラー   | 青     | ヒーラーロールを付与/解除   |

## 動作仕様

### 排他的ロール付与

- ボタンを押すと、対応するロールが**付与**され、他の2つは**自動解除**される
- 例: タンクロールを持った状態でアタッカーボタンを押す → タンク解除、アタッカー付与

### トグル動作

- 既に持っているロールのボタンを押すと、そのロールが**解除**される
- 例: タンクロールを持った状態でタンクボタンを押す → タンク解除（どのロールも持たない状態に）

### エラー処理

- BOTのロール位置が低い場合、コマンド実行時にエラーを表示
- ボタン押下時のロール操作失敗もエラーメッセージを表示（ephemeral）

## 技術仕様

### customId形式

```
bpsr-role:<type>:<tankRoleId>:<attackerRoleId>:<healerRoleId>
```

- `type`: `tank` / `attacker` / `healer`
- ロールIDはDiscordスノーフレーク（18-19桁）

### 実装ファイル

| ファイル                                            | 内容               |
| --------------------------------------------------- | ------------------ |
| `src/commands/BpsrRoleCommand.ts`                   | コマンド本体       |
| `src/interaction-handlers/BpsrRoleButtonHandler.ts` | ボタンハンドラ     |
| `src/lib/bpsr-role-utils.ts`                        | ユーティリティ関数 |

## 使用例

### 基本的な使い方

```
/bpsr-role tank:@Tank attacker:@Attacker healer:@Healer
```

### カスタムタイトル/説明付き

```
/bpsr-role tank:@Tank attacker:@Attacker healer:@Healer title:ジョブ選択 body:下のボタンから希望のジョブを選んでください
```

## 注意事項

1. **ロール階層**: BOTのロールより下にある3つのロールを指定すること
2. **永続性**: パネルはDBに保存されないため、メッセージを削除するとパネルは復元不可
3. **複数パネル**: 同じチャンネルに複数のパネルを設置可能（それぞれ独立して動作）
